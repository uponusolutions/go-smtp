<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# tester

```go
import "github.com/uponusolutions/go-smtp/tester"
```

Package smtptester implements a simple SMTP server for testing. All received mails are saved in a sync.Map with a key:

```
From+Recipient1+Recipient2
```

Mails to the same sender and recipients will overwrite a previous received mail, when the recipients slice has the same order as in the mail received before.

## Index

- [func GenX509KeyPair\(domain string\) \(tls.Certificate, error\)](<#GenX509KeyPair>)
- [func LookupKey\(f string, r \[\]string\) string](<#LookupKey>)
- [func ReaderCompareTest\(t \*testing.T, fs \*embed.FS, path string, expected func\(io.Reader\) \(\[\]byte, error\), actual func\(io.Reader\) \(\[\]byte, error\)\)](<#ReaderCompareTest>)
- [func Standard\(\) \*server.Server](<#Standard>)
- [func StandardWithAddress\(addr string\) \*server.Server](<#StandardWithAddress>)
- [func WriterCompareTest\(t \*testing.T, fs \*embed.FS, path string, expected func\(io.Writer\) io.WriteCloser, actual func\(io.Writer\) io.WriteCloser\)](<#WriterCompareTest>)
- [type Backend](<#Backend>)
  - [func GetBackend\(s \*server.Server\) \*Backend](<#GetBackend>)
  - [func NewBackend\(\) \*Backend](<#NewBackend>)
  - [func \(b \*Backend\) Add\(m \*Mail\)](<#Backend.Add>)
  - [func \(b \*Backend\) Load\(from string, recipients \[\]string\) \(\*Mail, bool\)](<#Backend.Load>)
  - [func \(b \*Backend\) NewSession\(ctx context.Context, \_ \*server.Conn\) \(context.Context, server.Session, error\)](<#Backend.NewSession>)
- [type FakeConn](<#FakeConn>)
  - [func NewFakeConn\(in string, out \*bytes.Buffer\) \*FakeConn](<#NewFakeConn>)
  - [func NewFakeConnStream\(in io.Reader, out \*bytes.Buffer\) \*FakeConn](<#NewFakeConnStream>)
  - [func \(FakeConn\) Close\(\) error](<#FakeConn.Close>)
  - [func \(FakeConn\) LocalAddr\(\) net.Addr](<#FakeConn.LocalAddr>)
  - [func \(f FakeConn\) RemoteAddr\(\) net.Addr](<#FakeConn.RemoteAddr>)
  - [func \(FakeConn\) SetDeadline\(time.Time\) error](<#FakeConn.SetDeadline>)
  - [func \(FakeConn\) SetReadDeadline\(time.Time\) error](<#FakeConn.SetReadDeadline>)
  - [func \(FakeConn\) SetWriteDeadline\(time.Time\) error](<#FakeConn.SetWriteDeadline>)
- [type Mail](<#Mail>)
  - [func \(m \*Mail\) LookupKey\(\) string](<#Mail.LookupKey>)
- [type Session](<#Session>)
  - [func \(Session\) Auth\(\_ context.Context, \_ string\) \(sasl.Server, error\)](<#Session.Auth>)
  - [func \(Session\) AuthMechanisms\(\_ context.Context\) \[\]string](<#Session.AuthMechanisms>)
  - [func \(s \*Session\) Close\(\_ context.Context, \_ error\)](<#Session.Close>)
  - [func \(s \*Session\) Data\(\_ context.Context, r func\(\) io.Reader\) \(string, error\)](<#Session.Data>)
  - [func \(Session\) Logger\(\_ context.Context\) \*slog.Logger](<#Session.Logger>)
  - [func \(s \*Session\) Mail\(\_ context.Context, from string, \_ \*smtp.MailOptions\) error](<#Session.Mail>)
  - [func \(s \*Session\) Rcpt\(\_ context.Context, to string, \_ \*smtp.RcptOptions\) error](<#Session.Rcpt>)
  - [func \(s \*Session\) Reset\(ctx context.Context, \_ bool\) \(context.Context, error\)](<#Session.Reset>)
  - [func \(Session\) STARTTLS\(\_ context.Context, config \*tls.Config\) \(\*tls.Config, error\)](<#Session.STARTTLS>)
  - [func \(Session\) Verify\(\_ context.Context, \_ string, \_ \*smtp.VrfyOptions\) error](<#Session.Verify>)


<a name="GenX509KeyPair"></a>
## func GenX509KeyPair

```go
func GenX509KeyPair(domain string) (tls.Certificate, error)
```

GenX509KeyPair generates a self signed smtp server certificate with the given domain.

<a name="LookupKey"></a>
## func LookupKey

```go
func LookupKey(f string, r []string) string
```

LookupKey returns a key of the format:

```
m.From+m.Recipient_1+m.Recipient_2...
```

<a name="ReaderCompareTest"></a>
## func ReaderCompareTest

```go
func ReaderCompareTest(t *testing.T, fs *embed.FS, path string, expected func(io.Reader) ([]byte, error), actual func(io.Reader) ([]byte, error))
```

ReaderCompareTest reads all files out of fs\[path\] and compares the result of the expected func against the actual func. To simulate differences of Read calls with different sizes it slices the files in increasing sizes up to 4048.

<a name="Standard"></a>
## func Standard

```go
func Standard() *server.Server
```

Standard returns a standard SMTP server listening on a random Port.

<a name="StandardWithAddress"></a>
## func StandardWithAddress

```go
func StandardWithAddress(addr string) *server.Server
```

StandardWithAddress with address returns a standard SMTP server listenting on addr.

<a name="WriterCompareTest"></a>
## func WriterCompareTest

```go
func WriterCompareTest(t *testing.T, fs *embed.FS, path string, expected func(io.Writer) io.WriteCloser, actual func(io.Writer) io.WriteCloser)
```

WriterCompareTest reads all files out of fs\[path\] and compares the expected func against the actual func. To simulate differences of Write calls of different sizes it slices the files in increasing sizes up to 4048.

<a name="Backend"></a>
## type Backend

Backend is the backend for out test server. It contains a sync.Map with all mails received.

```go
type Backend struct {
    Mails sync.Map
}
```

<a name="GetBackend"></a>
### func GetBackend

```go
func GetBackend(s *server.Server) *Backend
```

GetBackend returns the concrete type \*Backend from SMTP server.

<a name="NewBackend"></a>
### func NewBackend

```go
func NewBackend() *Backend
```

NewBackend returns a new Backend with an empty \(not nil\) Mails map.

<a name="Backend.Add"></a>
### func \(\*Backend\) Add

```go
func (b *Backend) Add(m *Mail)
```

Add adds mail to backends map.

<a name="Backend.Load"></a>
### func \(\*Backend\) Load

```go
func (b *Backend) Load(from string, recipients []string) (*Mail, bool)
```

Load loads mail from 'from' to recipients 'recipients'. The ok result indicates whether value was found in the map.

<a name="Backend.NewSession"></a>
### func \(\*Backend\) NewSession

```go
func (b *Backend) NewSession(ctx context.Context, _ *server.Conn) (context.Context, server.Session, error)
```

NewSession returns a new Session.

<a name="FakeConn"></a>
## type FakeConn

FakeConn fakes a conn for testing.

```go
type FakeConn struct {
    io.ReadWriter
    RemoteAddrReturn net.Addr
}
```

<a name="NewFakeConn"></a>
### func NewFakeConn

```go
func NewFakeConn(in string, out *bytes.Buffer) *FakeConn
```

NewFakeConn creates a new FakeConn with a string as a input.

<a name="NewFakeConnStream"></a>
### func NewFakeConnStream

```go
func NewFakeConnStream(in io.Reader, out *bytes.Buffer) *FakeConn
```

NewFakeConnStream creates a new FakeConn with a stream as a input.

<a name="FakeConn.Close"></a>
### func \(FakeConn\) Close

```go
func (FakeConn) Close() error
```

Close always returns nil.

<a name="FakeConn.LocalAddr"></a>
### func \(FakeConn\) LocalAddr

```go
func (FakeConn) LocalAddr() net.Addr
```

LocalAddr always returns nil.

<a name="FakeConn.RemoteAddr"></a>
### func \(FakeConn\) RemoteAddr

```go
func (f FakeConn) RemoteAddr() net.Addr
```

RemoteAddr always returns RemoteAddrReturn.

<a name="FakeConn.SetDeadline"></a>
### func \(FakeConn\) SetDeadline

```go
func (FakeConn) SetDeadline(time.Time) error
```

SetDeadline always returns nil and does nothing.

<a name="FakeConn.SetReadDeadline"></a>
### func \(FakeConn\) SetReadDeadline

```go
func (FakeConn) SetReadDeadline(time.Time) error
```

SetReadDeadline always returns nil and does nothing.

<a name="FakeConn.SetWriteDeadline"></a>
### func \(FakeConn\) SetWriteDeadline

```go
func (FakeConn) SetWriteDeadline(time.Time) error
```

SetWriteDeadline always returns nil and does nothing.

<a name="Mail"></a>
## type Mail

Mail is one mail received by SMTP server.

```go
type Mail struct {
    From       string
    Recipients []string
    Data       []byte
}
```

<a name="Mail.LookupKey"></a>
### func \(\*Mail\) LookupKey

```go
func (m *Mail) LookupKey() string
```

LookupKey call LookupKey for current mail.

<a name="Session"></a>
## type Session

A Session is returned after successful login.

```go
type Session struct {
    // contains filtered or unexported fields
}
```

<a name="Session.Auth"></a>
### func \(Session\) Auth

```go
func (Session) Auth(_ context.Context, _ string) (sasl.Server, error)
```

Auth implements the Auth interface.

<a name="Session.AuthMechanisms"></a>
### func \(Session\) AuthMechanisms

```go
func (Session) AuthMechanisms(_ context.Context) []string
```

AuthMechanisms implements the AuthMechanisms interface.

<a name="Session.Close"></a>
### func \(\*Session\) Close

```go
func (s *Session) Close(_ context.Context, _ error)
```

Close implements the Close interface.

<a name="Session.Data"></a>
### func \(\*Session\) Data

```go
func (s *Session) Data(_ context.Context, r func() io.Reader) (string, error)
```

Data implements the Data interface.

<a name="Session.Logger"></a>
### func \(Session\) Logger

```go
func (Session) Logger(_ context.Context) *slog.Logger
```

Logger implements the Logger interface.

<a name="Session.Mail"></a>
### func \(\*Session\) Mail

```go
func (s *Session) Mail(_ context.Context, from string, _ *smtp.MailOptions) error
```

Mail implements the Mail interface.

<a name="Session.Rcpt"></a>
### func \(\*Session\) Rcpt

```go
func (s *Session) Rcpt(_ context.Context, to string, _ *smtp.RcptOptions) error
```

Rcpt implements the Rcpt interface.

<a name="Session.Reset"></a>
### func \(\*Session\) Reset

```go
func (s *Session) Reset(ctx context.Context, _ bool) (context.Context, error)
```

Reset implements Reset interface.

<a name="Session.STARTTLS"></a>
### func \(Session\) STARTTLS

```go
func (Session) STARTTLS(_ context.Context, config *tls.Config) (*tls.Config, error)
```

STARTTLS implements the STARTTLS interface.

<a name="Session.Verify"></a>
### func \(Session\) Verify

```go
func (Session) Verify(_ context.Context, _ string, _ *smtp.VrfyOptions) error
```

Verify implements the Verify interface.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->